<!-- Chai Card Component -->
<div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-2xl transition-shadow duration-300 chai-card" data-chai-id="{{ chai.id }}">
    <!-- Image -->
    <div class="relative overflow-hidden h-48">
        <img src="{{ chai.image.url }}" alt="{{ chai.name }}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
        
        <!-- Favorite Button (Top Right) -->
        {% if user.is_authenticated %}
            <button class="favorite-btn absolute top-3 right-3 bg-white rounded-full p-2 shadow-md hover:bg-red-500 hover:text-white transition-colors duration-200" 
                data-chai-id="{{ chai.id }}" title="Add to favorites">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"></path>
                </svg>
            </button>
        {% endif %}
        
        <!-- Type Badge -->
        <div class="absolute top-3 left-3 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold">
            {{ chai.get_chai_type_display }}
        </div>
    </div>

    <!-- Content -->
    <div class="p-4">
        <!-- Name -->
        <h3 class="text-xl font-bold mb-2 text-gray-800">{{ chai.name }}</h3>
        
        <!-- Description -->
        <p class="text-gray-600 text-sm mb-3 line-clamp-2">{{ chai.description }}</p>
        
        <!-- Rating & Reviews -->
        <div class="flex items-center justify-between mb-3 pb-3 border-b">
            <div class="flex items-center gap-1">
                <span class="text-yellow-400 text-lg">★</span>
                <span class="font-bold text-gray-800">{{ chai.avg_rating }}</span>
                <span class="text-gray-500 text-sm">({{ chai.review_count }} reviews)</span>
            </div>
            <span class="text-red-500 text-sm font-semibold">{{ chai.get_favorite_count }} ♥</span>
        </div>

        <!-- Price -->
        <div class="mb-4">
            <span class="text-2xl font-bold text-orange-600">₹{{ chai.price }}</span>
        </div>

        <!-- View Details Button -->
        <a href="{% url 'chai_detail' chai.id %}" class="block w-full bg-gradient-to-r from-orange-500 to-red-500 text-white text-center py-2 rounded-lg font-semibold hover:from-orange-600 hover:to-red-600 transition-all duration-200">
            View Details →
        </a>
    </div>
</div>

<script>
document.querySelectorAll('.favorite-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        const chaiId = this.dataset.chaiId;
        const btn = this;
        
        fetch(`/chai/${chaiId}/favorite/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '',
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                btn.classList.toggle('bg-red-500', data.favorited);
                btn.classList.toggle('text-white', data.favorited);
                
                // Update favorite count
                const card = btn.closest('.chai-card');
                const favCount = card.querySelector('[data-fav-count]');
                if (favCount) {
                    favCount.textContent = data.favorite_count;
                }
                
                // Show toast notification
                showToast(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    });
});

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg animation-slide-up z-50';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideDown 0.3s ease-out forwards';
        setTimeout(() => toast.remove(), 300);
    }, 2000);
}
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

@keyframes slideUp {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes slideDown {
    from { transform: translateY(0); opacity: 1; }
    to { transform: translateY(100%); opacity: 0; }
}
</style>
